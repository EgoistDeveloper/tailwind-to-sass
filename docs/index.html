<!DOCTYPE html>
<html>

<head>
    <title>Tailwind CSS to SASS Converter</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <link rel="shortcut icon" href="./assets/favicon.png" type="image/x-icon">

    <!-- Roboto Font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">

    <!-- Vuetify -->
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">

    <!-- Monaco Editor -->
    <link rel="stylesheet" data-name="vs/editor/editor.main"
        href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.min.css">

    <style>
        [v-cloak]>* {
            display: none
        }

        [v-cloak]::before {
            content: "loadingâ€¦";
            opacity: 0;
        }

        .code-container {
            height: 80vh;
            width: 100%;
            padding-top: 10px;
        }

        header.v-toolbar {
          max-height: 65px;
          box-shadow: 0 2px 4px -1px rgb(0 0 0 / 20%), 0 4px 5px 0 rgb(0 0 0 / 0%), 0 1px 10px 0 rgb(0 0 0 / 2%) !important;
        }

        .v-slide-group__wrapper {
          border-bottom: 1px solid #e0e0e0 !important;
        }

        .v-card {
          border: 1px solid #e0e0e0 !important;
        }

        .vue-splitter .splitter {
          background-color: #d8d8d8 !important;
          margin: 65px 10px 0px;
          transition: all 0.3s ease-in-out;
        }

        .vue-splitter .splitter:hover {
          background-color: #c2c2c2 !important;
        }

        @media (prefers-color-scheme: dark) {
          .vue-splitter .splitter {
            background-color: #4b4b4b !important;
          }

          .vue-splitter .splitter:hover {
            background-color: #646464 !important;
          }

          .v-card {
            border: 1px solid #3e3e3e !important;
          }

          .v-slide-group__wrapper {
            border-bottom: 1px solid #3e3e3e !important;
          }
        }

        /* loading animation */
        .loader,
        .loader:after {
          border-radius: 50%;
          width: 10em;
          height: 10em;
        }
        .loader {
          top: 45vh !important;
          margin: 60px auto;
          font-size: 5px;
          position: relative;
          text-indent: -9999em;
          border-top: 1.1em solid rgba(123, 123, 123, 0.2);
          border-right: 1.1em solid rgba(123, 123, 123, 0.2);
          border-bottom: 1.1em solid rgba(123, 123, 123, 0.2);
          border-left: 1.1em solid #626262;
          -webkit-transform: translateZ(0);
          -ms-transform: translateZ(0);
          transform: translateZ(0);
          -webkit-animation: load8 1.1s infinite linear;
          animation: load8 1.1s infinite linear;
        }
        @-webkit-keyframes load8 {
          0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
          }
          100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
          }
        }
        @keyframes load8 {
          0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
          }
          100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
          }
        }
    </style>
</head>

<body>
    <div class="loader">Loading...</div>

    <div id="app">
        <v-app v-cloak>
            <!-- Navbar -->
            <v-toolbar class="pa-0">
                <v-row>
                    <v-col cols="2"></v-col>

                    <v-col class="d-flex justify-space-around">
                      <v-toolbar-title>
                          <img src="./assets/favicon.png" height="20" width="20" alt="Logo">

                            TailwindCSS to SASS Converter
                        </v-toolbar-title>
                    </v-col>

                    <v-col cols="2" class="d-flex justify-end">
                        <a class="github-button mx-10"
                            href="https://github.com/EgoistDeveloper/twcss-to-sass"
                            data-color-scheme="no-preference: dark; light: light; dark: dark;"
                            data-icon="octicon-star"
                            data-size="large"
                            data-show-count="true"
                            aria-label="Star facebook/react on GitHub">
                            Star on Github
                        </a>
                    </v-col>
            </v-toolbar>

            <!-- Main Container -->
            <v-main class="my-3">
                <v-container fluid>
                  <!-- Splitter Container -->
                  <vue-splitter v-on:resize="onSplitterResize()" class="mx-auto">
                    <!-- Source Pane -->
                    <div slot="left-pane" class="overflow-hidden">
                      <v-row>
                        <v-col cols="12">
                            <v-card>
                              <!-- Title -->
                              <v-card-title primary-title class="justify-center">
                                <div>
                                  <h5 class="blue--text">
                                    TailwindCSS HTML Template
                                  </h5>
                                </div>
                              </v-card-title>

                              <v-divider></v-divider>

                              <v-tabs v-model="inputTabModel">
                                <v-tab href="#inputHtmlTab" @click="onInputTabSwitch('inputHtmlTab')">
                                  HTML
                                </v-tab>
                              </v-tabs>

                              <v-tabs-items v-model="inputTabModel">
                                <!-- Input HMTL Editor -->
                                <v-tab-item :key="1" value="inputHtmlTab" :eager="true">
                                  <div id="inputHtmlEditorContainer" class="code-container"></div>
                                </v-tab-item>
                              </v-tabs-items>
                            </v-card>
                        </v-col>
                      </v-row>
                    </div>

                    <!-- Output Pane -->
                    <div slot="right-pane" class="overflow-hidden">
                      <v-row>
                        <v-col cols="12">
                          <v-card class="b-1">
                            <!-- Title -->
                            <v-card-title primary-title class="justify-center">
                              <div>
                                <h5 class="green--text">
                                  Output
                                </h5>
                              </div>
                            </v-card-title>

                            <v-divider></v-divider>

                            <v-tabs v-model="outputTabModel">
                              <v-tab href="#outputHtmlTab" @click="onOutputTabSwitch('outputHtmlTab')">
                                HTML
                              </v-tab>

                              <v-tab href="#outputSassTab" @click="onOutputTabSwitch('outputSassTab')">
                                SASS
                              </v-tab>
                            </v-tabs>

                            <v-tabs-items v-model="outputTabModel">
                              <!-- Output HMTL Editor -->
                              <v-tab-item :key="1" value="outputHtmlTab" :eager="true">
                                <div id="outputHtmlEditorContainer" class="code-container"></div>
                              </v-tab-item>

                              <!-- Output SASS Editor -->
                              <v-tab-item :key="2" value="outputSassTab" :eager="true">
                                <div id="outputSassEditorContainer" class="code-container"></div>
                              </v-tab-item>
                            </v-tabs-items>
                          </v-card>
                        </v-col>
                      </v-row>
                    </div>
                  </vue-splitter>
                </v-container>
            </v-main>
        </v-app>
    </div>

    <!-- VueJS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>

    <!-- @rmp135/vue-splitter -->
    <script src="https://unpkg.com/@rmp135/vue-splitter@latest/dist/vue-splitter.js"></script>

    <!-- Vuetify -->
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>

    <!-- store -->
    <script src="https://unpkg.com/store@latest/dist/store.modern.min.js"></script>

    <!-- html-validate -->
    <script src="https://unpkg.com/store@2.0.12/dist/store.modern.min.js"></script>

    <!-- twcss-to-sass -->
    <script src="https://unpkg.com/@egoistdeveloper/twcss-to-sass@latest/dist/umd/index.js"></script>
    <!-- <script src="../dist/umd/index.js"></script> -->

    <!-- Monaco Editor -->
    <script>
        var require = {
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs'
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.nls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.js"></script>

    <!-- Github Buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- App -->
    <script>
        const isBrowserDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;

        new Vue({
            el: '#app',
            vuetify: new Vuetify({
                theme: {
                    dark: isBrowserDarkTheme
                },
            }),

            components: {
              VueSplitter
            },

            data: {
                htmlInput: null,
                sassOutput: null,
                htmlMonacoEditor: null,
                outputSassMonacoEditor: null,
                inputTabModel: null,
                outputTabModel: null
            },

            methods: {
                /** load monaco code editors */
                loadEditors: function () {
                    const defaultTemplate =
                        `<!-- Container Start -->\n<!-- Container Any -->\n<div class="bg-white">\n\t<!-- Some Div -->\n\t<div class="flex justify-center items-center min-h-screen min-w-full">\n\t\t<div class="flex relative">\n\t\t\t<!-- Inner Div -->\n\t\t\t<div class="w-72 h-40 bg-green-400 transform transition-all skew-x-12 -skew-y-12 absolute rounded-lg">\n\t\t\t\tMy Text 1\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<!-- Container End-->`;
                    const userTemplate = store.get('userTemplate') || defaultTemplate;

                    const {
                        convertToSass
                    } = TwCssToSass;

                    const theme = this.getCurrentTheme(),
                        commonEditorConfig = {
                            theme: `vs-${theme}`,
                            minimap: {
                                enabled: false
                            }
                        };

                    const converterConfigs = {
                          useCommentBlocksAsClassName: true,
                          printComments: true,
                          classNameOptions: {
                            lowercase: true,
                            replaceWith: '-',
                            prefix: '',
                            suffix: ''
                          }
                        };

                    //#region Input Editors

                    inputHtmlMonacoEditor = monaco.editor.create(document.getElementById('inputHtmlEditorContainer'), Object
                        .assign(commonEditorConfig, {
                            value: userTemplate.template ? userTemplate.template : defaultTemplate,
                            language: 'html',
                        }));

                    inputHtmlMonacoEditor.onDidChangeModelContent(function (e) {
                        const template = inputHtmlMonacoEditor.getValue();

                        let converterResult = convertToSass(template, converterConfigs);

                        outputHtmlMonacoEditor.getModel().setValue(converterResult.html);
                        outputSassMonacoEditor.getModel().setValue(converterResult.sass);

                        store.set('userTemplate', {
                          template: template,
                          output: converterResult
                        });
                    });

                    //#endregion


                    //#region Output Editors

                    outputHtmlMonacoEditor = monaco.editor.create(document.getElementById('outputHtmlEditorContainer'), Object
                      .assign(commonEditorConfig, {
                          language: 'html',
                      }));

                    // Output SASS Editor
                    outputSassMonacoEditor = monaco.editor.create(document.getElementById('outputSassEditorContainer'), Object
                        .assign(commonEditorConfig, {
                            language: 'scss',
                        }));

                    let converterResult = convertToSass(userTemplate.template ? userTemplate.template : defaultTemplate, converterConfigs);

                    outputHtmlMonacoEditor.getModel().setValue(converterResult.html);
                    outputSassMonacoEditor.getModel().setValue(converterResult.sass);

                    //#endregion
                },

                /** get current browser theme */
                getCurrentTheme: function () {
                    if (window.matchMedia) {
                        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    }
                },

                /** watch browser theme*/
                watchBrowserTheme: function () {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                        const themeOption = {
                            theme: `vs-${e.matches ? 'dark' : 'light'}`
                        };

                        inputHtmlMonacoEditor.updateOptions(themeOption);

                        outputHtmlMonacoEditor.updateOptions(themeOption);
                        outputSassMonacoEditor.updateOptions(themeOption);

                        this.$vuetify.theme.isDark = e.matches;
                    });
                },

                /** resize editors on splitter position change */
                onSplitterResize: function(){
                  inputHtmlMonacoEditor.layout();

                  outputHtmlMonacoEditor.layout();
                  outputSassMonacoEditor.layout();
                },

                /** resize editors on input tabs switch */
                onInputTabSwitch: function(tab) {
                  setTimeout(() => {
                    if (tab == 'inputHtmlTab') {
                      inputHtmlMonacoEditor.layout();
                    }
                  }, 250);
                },

                /** resize editors on output tabs switch */
                onOutputTabSwitch: function(tab){
                  setTimeout(() => {
                    if (tab == 'outputHtmlTab') {
                      outputHtmlMonacoEditor.layout();
                    } else if (tab == 'outputSassTab') {
                      outputSassMonacoEditor.layout();
                    }
                  }, 250);
                },
            },

            mounted: function () {
              document.querySelector('.loader').remove();

              setTimeout(() => {
                this.loadEditors();
                this.watchBrowserTheme();

              }, 250);
            }
        });
    </script>
</body>

</html>
